<!DOCTYPE html>  <html> <head>   <title>index.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               index.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><strong>express-with-ease</strong> is an extensive wrapper for
<a href="http://expressjs.com/guide.html#creating-a server"><code>express.HTTPServer</code></a>
written in <a href="http://coffeescript.org">CoffeeScript</a>.</p>

<p>It takes care of setting important default values, as well as
loading configuration, middleware and most importantly define
<a href="http://en.wikipedia.org/wiki/Representational_state_transfer"><strong>RESTful</a> default routes</strong>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>Installation with NPM</h3>

<p><code>$ npm install express-with-ease</code></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Application Structure</h3>

<p>An <strong>express-with-ease</strong> application follows a certain convention on where different
parts can be found. All paths are relative to the application root
directory.</p>

<pre><code>.
├── app.coffee    - main application file
├── config.coffee - configuration file
├── lib/          - directory for general code
├── models/       - models
├── public/       - publicly available static files
├── resources/    - resource controllers
└── views/        - layouts and views for resource controllers
</code></pre>

<p>However, all these paths are configurable.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h3>Example</h3>

<h4>app.coffee:</h4>

<pre><code>Ease = require 'express-with-ease'

server = new Ease
server.listen()
</code></pre>

<h4>resources/posts.coffee:</h4>

<pre><code>module.exports = class Posts
    index: (request, response) -&gt;
        response.render 'posts/index', { posts: [...] }

    show: (request, response) -&gt;
        response.render 'posts/show', { post: ... }
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h3>Configuration</h3>

<p>You can pass an object to <code>Ease</code> with the following keys:</p>

<ul>
<li><p><code>config.port</code>: defaults to 4000</p></li>
<li><p><code>config.base_path</code>: defaults to <code>/</code></p></li>
<li><p><code>config.resources_path</code>: defaults to <code>resources/</code></p></li>
<li><p><code>config.base_resource</code>: resource that handles the <code>base_path</code> route, <em>no default value</em></p></li>
<li><p><code>config.views_path</code>: defaults to <code>views/</code></p></li>
<li><p><code>config.view_engine</code>: defaults to <code>jade</code>, for others see the
<a href="http://expressjs.com/guide.html#template-engines">list of commonly used template engines</a></p></li>
<li><p><code>config.sessions.secret</code>: secret key, <em>no default value</em></p></li>
<li><p><code>config.sessions.store</code>: session store (object), e.g. <code>new MemcachedStore({ hosts: [ 'localhost:11211' ] })</code></p></li>
<li><p><code>config.ssl.key</code>: path to an SSL key file</p></li>
<li><p><code>config.ssl.cert</code>: path to an SSL certificate file,
note: if a valid key/certificate pair is given, the server automatically listens only for secure
connections</p></li>
<li><p><code>config.middleware</code>: an array of connect compliant middleware objects</p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h4>Example:</h4>

<h5>config.coffee:</h5>

<pre><code>path           = require 'path'
MemcachedStore = require 'connect-memcached'

module.exports =
    port: 4000
    base_path: '/'
    base_resource: 'sessions'
    resources_path: 'resources'
    view_engine: 'jade'
    views_path:  'views'
    assets_path: 'public'

    sessions:
        secret: '50389e82cd8c38a801f7120f61cc1efc0c7e362b'

        # See the Connect wiki for a list of possible session
        # stores:
        # https://github.com/senchalabs/connect/wiki
        store: new MemcachedStore { hosts: 'localhost:11211' }

    # Comment out the whole SSL block if you want to disable it.
    ssl:
        key:  path.join('config', 'server.key')
        cert: path.join('config', 'server.crt')
</code></pre>

<h5>app.coffee:</h5>

<pre><code>path = require 'path'
Ease = require 'express-with-ease'

# Add current directory to `require`'s load paths.
require.paths.push __dirname

server = new Ease require 'config'
server.listen()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h3>License</h3>

<p>Copyright (c) 2011 Brainsware, <a href="http://brainsware.org">brainsware.org</a></p>

<p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the "Software"),
to deal in the Software without restriction, including without limitation the
rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
sell copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">express = </span><span class="nx">require</span> <span class="s1">&#39;express&#39;</span>
<span class="nv">path    = </span><span class="nx">require</span> <span class="s1">&#39;path&#39;</span>
<span class="nv">fs      = </span><span class="nx">require</span> <span class="s1">&#39;fs&#39;</span>
<span class="nv">file    = </span><span class="nx">require</span> <span class="s1">&#39;file&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h3>Public methods</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">module.exports = </span><span class="k">class</span> <span class="nx">Ease</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h4><code>Ease.constructor (config, root)</code></h4>

<p>Creates and configures an express app instance, as returned
by express.createServer.</p>

<p>Parameters:</p>

<ul>
<li><p><code>config</code> object, defaults to empty object</p></li>
<li><p><code>root</code> path, application root, defaults to the directory of
the including module. (e.g. app.coffee in the above examples)</p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">constructor: </span><span class="p">(</span><span class="vi">@config = </span><span class="p">{},</span> <span class="vi">@root = </span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">filename</span><span class="p">))</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Workaround: @server_options returns undefined if SSL is not
configured. Express' createServer doesn't like options being
undefined. Or empty. Or null.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">ssl</span><span class="o">?</span>
			<span class="vi">@app = </span><span class="nx">express</span><span class="p">.</span><span class="nx">createServer</span> <span class="nx">@server_options</span><span class="p">()</span>
		<span class="k">else</span>
			<span class="vi">@app = </span><span class="nx">express</span><span class="p">.</span><span class="nx">createServer</span><span class="p">()</span>

		<span class="nx">@configure</span><span class="p">()</span>
		<span class="nx">@register_middleware</span><span class="p">()</span>
		<span class="nx">@register_resources</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h4><code>Ease.listen (port)</code></h4>

<p>Fires up the server and starts listening on <code>config.port</code>, given port or
default port 4000.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">listen: </span><span class="nf">(port = 4000) -&gt;</span>
		<span class="nx">@app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">@config</span><span class="p">.</span><span class="nx">port</span> <span class="o">||</span> <span class="nx">port</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>Internal methods</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Sets values according to the config file.</p>

<ul>
<li><p><code>basepath</code>: <code>config.base_path</code>, defaults to <code>/</code></p></li>
<li><p><code>views</code>: <code>config.views_path</code>, defaults to <code>views/</code></p></li>
<li><p><code>view engine</code>: <code>config.view_engine</code>, defaults to <code>jade</code></p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">configure: </span><span class="o">-&gt;</span>
		<span class="nx">@app</span><span class="p">.</span><span class="nx">set</span> <span class="s1">&#39;basepath&#39;</span><span class="p">,</span>    <span class="nx">@config</span><span class="p">.</span><span class="nx">base_path</span>   <span class="o">or</span> <span class="s1">&#39;/&#39;</span>
		<span class="nx">@app</span><span class="p">.</span><span class="nx">set</span> <span class="s1">&#39;views&#39;</span><span class="p">,</span>       <span class="nx">@config</span><span class="p">.</span><span class="nx">views_path</span>  <span class="o">or</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">@root</span><span class="p">,</span> <span class="s1">&#39;views&#39;</span>
		<span class="nx">@app</span><span class="p">.</span><span class="nx">set</span> <span class="s1">&#39;view engine&#39;</span><span class="p">,</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">view_engine</span> <span class="o">or</span> <span class="s1">&#39;jade&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Registers middleware for development environment,
enabling output of exceptions incl. stack.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">development: </span><span class="o">=&gt;</span>
		<span class="nx">@app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span>
			<span class="nv">dumpExceptions: </span><span class="kc">true</span>
			<span class="nv">showStack: </span><span class="kc">true</span>

		<span class="nx">@app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">logger</span> <span class="nv">format: </span><span class="s1">&#39;dev&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Registers necessary middleware.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">register_middleware: </span><span class="o">-&gt;</span>
		<span class="nx">@app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">bodyParser</span><span class="p">()</span>
		<span class="nx">@app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">cookieParser</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Register session middleware - if configured:</p>

<ul>
<li><p><code>config.sessions.secret</code>: Session secret</p></li>
<li><p><code>config.sessions.store</code>: Session store object, e.g. <code>new MemcachedStore({ hosts: [ 'localhost:11211' ] })</code></p></li>
</ul>

<p>For possible session stores, see the
<a href="https://github.com/senchalabs/connect/wiki">Connect Wiki</a></p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">sessions</span><span class="o">?</span>
			<span class="nx">@app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">session</span> <span class="p">{</span> <span class="nv">secret: </span><span class="nx">@config</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="nx">secret</span><span class="p">,</span> <span class="nv">store: </span><span class="nx">@config</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="nx">store</span> <span class="p">}</span>

		<span class="nx">@app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">()</span>
		<span class="nx">@app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">@app</span><span class="p">.</span><span class="nx">router</span>
		<span class="nx">@app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">static</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">assets_path</span> <span class="o">or</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">@root</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Register all additional middleware present in the array
<code>config.middleware</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">middleware</span><span class="o">?</span>
			<span class="k">for</span> <span class="nx">middleware</span> <span class="k">in</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">middleware</span>
				<span class="nx">@app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">middleware</span>

		<span class="nx">@app</span><span class="p">.</span><span class="nx">configure</span> <span class="s1">&#39;development&#39;</span><span class="p">,</span> <span class="nx">@development</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Checks whether SSL is enabled in the config and returns
necessary options for <code>express.createServer</code>.</p>

<p>SSL is enabled by setting <code>config.ssl.key</code> and
<code>config.ssl.cert</code> to the respective (absolute, or relative
to the app root) paths.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">server_options: </span><span class="o">-&gt;</span>
		<span class="k">return</span> <span class="kc">undefined</span> <span class="nx">unless</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">ssl</span><span class="o">?</span>

		<span class="p">{</span>
			<span class="nv">key: </span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">ssl</span><span class="p">.</span><span class="nx">key</span>
			<span class="nv">cert: </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">ssl</span><span class="p">.</span><span class="nx">cert</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Find and register all available resources in <code>config.resources_path</code>.</p>

<p><code>config.resources_path</code> defaults to <code>resources</code></p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">register_resources: </span><span class="o">-&gt;</span>
		<span class="nx">@controllers</span> <span class="o">||=</span> <span class="p">[]</span>
		<span class="nx">@config</span><span class="p">.</span><span class="nx">resources_path</span> <span class="o">||=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">@root</span><span class="p">,</span> <span class="s1">&#39;resources&#39;</span>

		<span class="nx">file</span><span class="p">.</span><span class="nx">walkSync</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">resources_path</span><span class="p">,</span> <span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">directories</span><span class="p">,</span> <span class="nx">files</span><span class="p">)</span> <span class="o">=&gt;</span>
			<span class="k">for</span> <span class="nx">filename</span> <span class="k">in</span> <span class="nx">files</span> <span class="k">when</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/\.coffee$/</span>
				<span class="nx">@register_controller</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">@get_relative_path</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">filename</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Register routes for a specific resource controller</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">register_controller: </span><span class="nf">(start, filename, relative_path) -&gt;</span>
		<span class="nv">route = </span><span class="nx">@route_from_path</span><span class="p">(</span><span class="nx">relative_path</span><span class="p">)</span>

		<span class="nx">@controllers</span><span class="p">[</span><span class="nx">relative_path</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">require</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">filename</span><span class="p">))</span>

		<span class="k">for</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">fn</span> <span class="k">of</span> <span class="nx">@controllers</span><span class="p">[</span><span class="nx">relative_path</span><span class="p">].</span><span class="nx">prototype</span>
			<span class="nx">@register_route</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">route</span><span class="p">,</span> <span class="nx">@proxy</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">@controllers</span><span class="p">[</span><span class="nx">relative_path</span><span class="p">],</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">relative_path</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Additionally, the value of <code>config.base_resource</code> is used
to deduct what controller should map to <code>/</code></p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">@register_route</span> <span class="nx">method</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">@proxy</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">@controllers</span><span class="p">[</span><span class="nx">relative_path</span><span class="p">],</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">relative_path</span><span class="p">)</span> <span class="k">if</span> <span class="nx">relative_path</span> <span class="o">is</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">base_resource</span>

	<span class="nv">proxy: </span><span class="nf">(fn, method, relative_path, request, response) -&gt;</span>
		<span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">||=</span> <span class="s1">&#39;html&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Throw 404 error if controller's @respond_to is defined but
doesn't include the requested format.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="nx">@respond_to</span><span class="o">?</span>
			<span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">format</span> <span class="k">in</span> <span class="nx">@respond_to</span>

		<span class="nx">fn</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Register a single route. This method uses <code>deduct_http_method</code>
and <code>deduct_route</code> to map accordingly.</p>

<p><em>Note:</em> if you name a method other than <code>index</code>, <code>show</code>, <code>new</code>,
<code>create</code>, <code>edit</code>, <code>update</code> or <code>destroy</code>, it will simply ignore it
and assume this is a utility method.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">register_route: </span><span class="nf">(method, route, fn) -&gt;</span>
		<span class="nv">http_method = </span><span class="nx">@deduct_http_method</span><span class="p">(</span><span class="nx">method</span><span class="p">)</span>
		<span class="nx">@app</span><span class="p">[</span><span class="nx">http_method</span><span class="p">]</span> <span class="nx">@deduct_route</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">route</span><span class="p">),</span> <span class="nx">fn</span> <span class="k">if</span> <span class="nx">http_method</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Find out what HTTP method given method responds to</p>

<ul>
<li><p><code>index</code>, <code>show</code>, <code>new</code>, <code>edit</code>: <strong>GET</strong></p></li>
<li><p><code>create</code>: <strong>POST</strong></p></li>
<li><p><code>update</code>: <strong>PUT</strong></p></li>
<li><p><code>destroy</code>: <strong>DELETE</strong></p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">deduct_http_method: </span><span class="nf">(method) -&gt;</span>
		<span class="k">switch</span> <span class="nx">method</span>
			<span class="k">when</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="s1">&#39;edit&#39;</span> <span class="k">then</span> <span class="s1">&#39;get&#39;</span>
			<span class="k">when</span> <span class="s1">&#39;create&#39;</span>                       <span class="k">then</span> <span class="s1">&#39;post&#39;</span>
			<span class="k">when</span> <span class="s1">&#39;update&#39;</span>                       <span class="k">then</span> <span class="s1">&#39;put&#39;</span>
			<span class="k">when</span> <span class="s1">&#39;destroy&#39;</span>                      <span class="k">then</span> <span class="s1">&#39;del&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Generates the relative path between the value of <code>config.resources_path</code>
and given resource (in this case identified by <code>start</code> and <code>filename</code>)</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">get_relative_path: </span><span class="nf">(start, filename) -&gt;</span>
		<span class="nx">file</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">relativePath</span><span class="p">(</span><span class="nx">@config</span><span class="p">.</span><span class="nx">resources_path</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="s1">&#39;.coffee&#39;</span><span class="p">)))</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Appends <code>:id</code>, <code>new</code> or <code>edit</code> to given route, according
to the method called.</p>

<ul>
<li><p><code>index</code>, <code>create</code>: nothing is appended</p></li>
<li><p><code>show</code>, <code>update</code>, <code>destroy</code>: <code>:id</code> is appended</p></li>
<li><p><code>new</code>: <code>new</code> is appended</p></li>
<li><p><code>edit</code>: <code>edit</code> is appended</p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">deduct_route: </span><span class="nf">(method, route) -&gt;</span>
		<span class="nv">new_route = </span><span class="k">switch</span> <span class="nx">method</span>
									<span class="k">when</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span>           <span class="k">then</span> <span class="nx">route</span>
									<span class="k">when</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span> <span class="k">then</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">route</span><span class="p">,</span> <span class="s1">&#39;:id&#39;</span>
									<span class="k">when</span> <span class="s1">&#39;new&#39;</span>                       <span class="k">then</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">route</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span>
									<span class="k">when</span> <span class="s1">&#39;edit&#39;</span>                      <span class="k">then</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">route</span><span class="p">,</span> <span class="s1">&#39;:id&#39;</span><span class="p">,</span> <span class="s1">&#39;edit&#39;</span>

		<span class="nx">new_route</span> <span class="o">+</span> <span class="s1">&#39;.:format?&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Turns a relative path into an actual URI:</p>

<ul>
<li><p><code>/foo</code>: <code>/foo</code></p></li>
<li><p><code>/foo/bar</code>: <code>/foo/:foo_id/bar</code></p></li>
<li><p><code>/foo.namespace/bar</code>: <code>/foo/bar</code></p></li>
</ul>

<p><em>Note:</em> the :id part for the last resources in path
are appended later (<code>deduct_route</code>), according to the
available methods.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">route_from_path: </span><span class="nf">(relative_path) -&gt;</span>
		<span class="nv">route = </span><span class="s1">&#39;/&#39;</span>
		<span class="nv">splitted_path = </span><span class="nx">relative_path</span><span class="p">.</span><span class="nx">split</span> <span class="s1">&#39;/&#39;</span>

		<span class="k">for</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">route_part</span> <span class="k">of</span> <span class="nx">splitted_path</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>NOTE: index would be a string, splitted_path.length is a number.
      CoffeeScript automagically transforms <code>'=='</code> to <code>'==='</code>, which
      then fails as <code>'1' === 1</code> yields <code>false</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">index = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span>

			<span class="nv">route = </span><span class="k">if</span> <span class="nx">splitted_path</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">or</span> <span class="nx">index</span> <span class="o">==</span> <span class="p">(</span><span class="nx">splitted_path</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
				<span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">route</span><span class="p">,</span> <span class="nx">route_part</span>
			<span class="k">else</span> <span class="k">if</span> <span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">route_part</span><span class="p">)</span> <span class="o">is</span> <span class="s1">&#39;.namespace&#39;</span>
				<span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">route</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">route_part</span><span class="p">,</span> <span class="s1">&#39;.namespace&#39;</span><span class="p">)</span>
			<span class="k">else</span>
				<span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">route</span><span class="p">,</span> <span class="nx">route_part</span><span class="p">,</span> <span class="s2">&quot;:#{route_part}_id&quot;</span>

		<span class="nx">route</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 